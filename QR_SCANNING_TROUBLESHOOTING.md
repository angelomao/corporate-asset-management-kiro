# QR Code Scanning Troubleshooting Guide

## Issue: Only Serial Number Fills In

If you're scanning a QR code and only the serial number field is being filled, here's how to debug and fix it:

### Step 1: Check Browser Console

1. Open your browser's Developer Tools (F12 or Right-click → Inspect)
2. Go to the **Console** tab
3. Scan the QR code again
4. Look for these log messages:
   ```
   QR Code scanned, raw data: {...}
   QR Code scan result: {...}
   Pre-filling form with: {...}
   ```

### Step 2: Verify QR Code Data

The QR code should contain JSON data like this:
```json
{
  "type": "asset",
  "name": "Test Laptop",
  "serialNumber": "TEST123",
  "category": "HARDWARE"
}
```

**If you see different data:**
- The QR code might be from a different system
- Regenerate the QR code using the QR Generator page

### Step 3: Test the Complete Flow

1. **Generate a fresh QR code:**
   - Go to QR Generator
   - Fill in:
     - Name: "My Test Device"
     - Serial: "SN12345"
     - Category: "Hardware"
   - Click "Generate QR Code"
   - Download it

2. **Scan it:**
   - Go to Assets page
   - Click "Scan QR"
   - Allow camera
   - Scan the QR code
   - Watch the console logs

3. **Check the form:**
   - The form should open automatically
   - All three fields should be filled:
     - Name: "My Test Device"
     - Serial Number: "SN12345"
     - Category: "Hardware"

### Step 4: Common Issues

#### Issue: Form doesn't open
**Solution:** Check console for errors. The backend might not be responding.

**Test backend:**
```bash
curl http://localhost:3001/health
```

#### Issue: Only serial number fills
**Possible causes:**
1. QR code contains only serial number (not from our generator)
2. JavaScript error preventing form fill
3. Backend API not processing correctly

**Check:**
- Look at console logs for "Pre-filling form with:"
- Verify all fields in the log output

#### Issue: "Invalid QR code" error
**Solution:** 
- Make sure you're scanning a QR code generated by this system
- The QR code must have `"type": "asset"` in the data

### Step 5: Manual Test

If scanning isn't working, you can manually test the flow:

1. Open browser console
2. Run this command:
```javascript
// Simulate a QR scan
const testData = JSON.stringify({
  type: 'asset',
  name: 'Test Device',
  serialNumber: 'TEST123',
  category: 'HARDWARE'
});

// This should trigger the form fill
// (You'll need to be on the Assets page)
```

### Step 6: Verify Backend API

Test the backend QR scan endpoint:

```bash
# Get auth token first (login)
TOKEN="your-jwt-token-here"

# Test QR scan endpoint
curl -X POST http://localhost:3001/api/qrcode/scan \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"data":"{\"type\":\"asset\",\"name\":\"Test\",\"serialNumber\":\"123\",\"category\":\"HARDWARE\"}"}'
```

Expected response:
```json
{
  "action": "register",
  "assetData": {
    "type": "asset",
    "name": "Test",
    "serialNumber": "123",
    "category": "HARDWARE"
  }
}
```

### What Should Happen

**Correct Flow:**
1. User scans QR code
2. Scanner reads JSON data
3. Data sent to backend `/api/qrcode/scan`
4. Backend validates and returns action: "register"
5. Frontend receives assetData
6. Form opens with all fields pre-filled
7. User completes remaining fields
8. User submits to create asset

### Debug Checklist

- [ ] QR code generated from QR Generator page
- [ ] QR code contains JSON with type, name, serial, category
- [ ] Browser console shows "QR Code scanned" log
- [ ] Backend API responds to /api/qrcode/scan
- [ ] Console shows "Pre-filling form with" log
- [ ] Form opens automatically
- [ ] All fields are filled (name, serial, category)

### Still Not Working?

1. **Refresh the page** and try again
2. **Clear browser cache** (Ctrl+Shift+Delete)
3. **Try a different browser** (Chrome recommended)
4. **Check backend logs:**
   ```bash
   docker-compose logs backend | tail -50
   ```
5. **Restart the system:**
   ```bash
   docker-compose restart
   ```

### Expected Console Output

When scanning works correctly, you should see:

```
QR Code scanned, raw data: {"type":"asset","name":"Test Laptop","serialNumber":"TEST123","category":"HARDWARE"}
QR Code scan result: {action: "register", assetData: {…}}
Pre-filling form with: {type: "asset", name: "Test Laptop", serialNumber: "TEST123", category: "HARDWARE"}
```

### Contact Support

If you've tried all the above and it still doesn't work:
1. Copy the console logs
2. Copy the QR code data
3. Note which step fails
4. Check the documentation in `docs/QR_CODE_FEATURE.md`

---

**Quick Fix:** If only serial number fills, the most likely cause is that you're scanning a QR code that only contains the serial number (not generated by our system). Generate a fresh QR code using the QR Generator page and try again.
